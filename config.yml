defaults:
  # Application specific configuration keys
  app:
    # Prefix for exchanges, should always be v1/
    exchangePrefix: v1/
    namespaceTableName: 'PulseNamespaces'
    namespacesExpirationDelay: '- 1 hour'

    # namespaces are rotated at this time interval.
    namespaceRotationInterval: '1 hour'

    # the virtualhost to manage
    virtualhost: /

    # permissions to give to users; {{namespace}} is replaced by the namespace.  Note that
    # when users are deleted, anything that user had permission to configure is also deleted!
    userConfigPermission: "^(queue/{{namespace}}/.*|exchange/{{namespace}}/.*)"
    userWritePermission: "^(queue/{{namespace}}/.*|exchange/{{namespace}}/.*)"
    userReadPermission: "^(queue/{{namespace}}/.*|exchange/.*)"

    # tags to be applied to new users
    userTags: [taskcluster-pulse]

    # If given, all namespaces must begin with this string; and only
    # matching queues and exchanges will be monitored.  Use this to
    # allow taskcluster-pulse to "share" a rabbitmq virtualhost with other
    # users.
    namespacePrefix: 'taskcluster-'

    amqpHostname: !env TASKCLUSTER_AMQP_HOSTNAME
    amqpUrl: !env TASKCLUSTER_AMQP_URL

  aws:
    accessKeyId:      !env AWS_ACCESS_KEY_ID
    secretAccessKey:  !env AWS_SECRET_ACCESS_KEY
    region:           us-east-1
    apiVersion:       2014-01-01

  taskcluster:
    credentials:      # Load strings from environment variables
      clientId:       !env TASKCLUSTER_CLIENT_ID
      accessToken:    !env TASKCLUSTER_ACCESS_TOKEN

  server:
    publicUrl:                https://pulse.taskcluster.net
    port:                     !env:number PORT
    env:                      !env NODE_ENV
    forceSSL:                 !env:bool FORCE_SSL
    trustProxy:               !env:bool TRUST_PROXY

  # Administrative credentials for RabbitMQ.  These credentials must have the
  # 'administrator' tag, and must have config and write permissions to all
  # queues and exchanges matching app.userConfigPermission and
  # app.userWritePermission, above.  RabbitMQ does limit administrators'
  # control, so it is a good practice to limit the user to *only* those queues
  # and exchanges if the RabbitMQ server is shared.
  rabbit:
    username:                 !env RABBIT_USERNAME
    password:                 !env RABBIT_PASSWORD
    baseUrl:                  !env RABBIT_BASE_URL

  azure:
    account:                  !env AZURE_ACCOUNT_NAME

  stressor:
    payloadSize:              !env STRESSOR_PAYLOAD_SIZE
    uploadRate:               !env STRESSOR_UPLOAD_RATE
    messageCount:             !env STRESSOR_MESSAGE_COUNT
    targetQueue:              !env STRESSOR_TARGET_QUEUE

  monitor:
    refreshInterval:              !env MONITOR_REFRESH_INTERVAL

  alerter:
    messageCountTolerance:        !env ALERTER_MESSAGE_COUNT_TOLERANCE
    messagePublishRateTolerance:  !env ALERTER_MESSAGE_PUBLISH_RATE_TOLERANCE

production:
  server:
    forceSSL:                 true
    trustProxy:               true
    env:                      'production'

test:
  app:
    amqpUrl: 'amqp://localhost'
    amqpHostname: localhost
    namespacePrefix: 'tcpulse-test-'
    namespaceRotationInterval: '1 hour'
    virtualhost: /
    userConfigPermission: "^(queue/{{namespace}}/.*|exchange/{{namespace}}/.*)"
    userWritePermission: "^(queue/{{namespace}}/.*|exchange/{{namespace}}/.*)"
    userReadPermission: "^(queue/{{namespace}}/.*|exchange/.*)"

  taskcluster:
    credentials:
      clientId:       'test-client'
      accessToken:    'none'

  stressor:
    payloadSize: 20
    uploadRate: 50
    messageCount: 5
    targetQueue: 'stressor queue'

  server:
    publicUrl:        http://localhost:60403
    port:             60403
    forceSSL:         false
    trustProxy:       false
    env:              development

  azure:
    account:  "inMemory"

  monitor:
    refreshInterval: 1000
    queuePrefix: 'taskcluster/'

  alerter:
    messageCountTolerance: 10
    messagePublishRateTolerance: 5
